<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>GXDiag - Multi-Language Typing Test</title>
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        /* --- CSS KHUSUS TYPING --- */
        
        /* Font Stack yang mendukung karakter CJK (China/Jepang/Korea) & Thai */
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', 'Meiryo', 'Malgun Gothic', 'Thonburi', sans-serif;
        }

        /* Container Kata */
        .word-box { 
            position: relative; /* KUNCI SCROLL */
            background: #111; 
            padding: 20px; 
            border-radius: 10px; 
            font-size: 1.6rem; 
            height: 130px; /* Sedikit lebih tinggi untuk karakter non-latin */
            overflow: hidden; 
            color: #666; 
            line-height: 1.8; 
            margin-bottom: 20px; 
            border: 2px solid #333; 
            user-select: none;
            box-shadow: inset 0 0 20px #000;
            white-space: pre-wrap; /* Agar spasi terbaca jelas */
        }

        /* Kata aktif */
        .word-active { 
            color: #111; 
            background: #00e5ff; 
            padding: 2px 6px; 
            border-radius: 4px; 
        }

        .word-correct { color: #eee; } 
        .word-wrong { color: #ff4081; text-decoration: line-through; } 

        /* Input Area */
        .input-box { 
            width: 100%; padding: 15px; font-size: 1.3rem; 
            background: #222; border: 2px solid #444; color: #fff; 
            border-radius: 10px; outline: none; transition: 0.2s;
        }
        .input-box:focus { border-color: #00e5ff; box-shadow: 0 0 15px rgba(0, 229, 255, 0.1); }
        .input-box:disabled { background: #1a1a1a; color: #555; border-color: #333; cursor: not-allowed; }

        /* Stats Bar & Controls */
        .stats-container {
            display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;
        }
        .stats { 
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; font-size: 1.2rem; color: #00e5ff; 
            background: #1e1e1e; padding: 15px; border-radius: 8px; border: 1px solid #333;
        }
        
        /* Language Select */
        .lang-select {
            background: #111; color: #fff; border: 1px solid #444; 
            padding: 5px 10px; border-radius: 5px; font-size: 0.9rem; cursor: pointer;
        }
        .lang-select:focus { border-color: #00e5ff; outline: none; }

        .restart-btn {
            width: 100%; padding: 12px; 
            background: #333; color: white; border: none; border-radius: 8px; 
            font-weight: bold; font-size: 1rem; transition: 0.2s; cursor: pointer;
        }
        .restart-btn:hover { background: #444; color: #00e5ff; }
    </style>
</head>
<body>
    <a href="../../index.html" class="back-btn">â† MENU</a>
    <h2 style="margin-top: 40px;">Typing Speed Challenge</h2>
    
    <div class="panel">
        <div class="stats-container">
            <div class="stats">
                <select id="lang-picker" class="lang-select" onchange="changeLanguage()">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="id">ğŸ‡®ğŸ‡© Indonesia</option>
                    <option value="jp">ğŸ‡¯ğŸ‡µ Japanese</option>
                    <option value="cn">ğŸ‡¨ğŸ‡³ Chinese</option>
                    <option value="kr">ğŸ‡°ğŸ‡· Korean</option>
                    <option value="th">ğŸ‡¹ğŸ‡­ Thai</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
                    <option value="de">ğŸ‡©ğŸ‡ª German</option>
                </select>
                
                <span id="time">Time: 60s</span>
                <span id="wpm">Speed: 0 WPM</span>
            </div>
        </div>
        
        <div class="word-box" id="display" onclick="document.getElementById('input').focus()"></div>
        
        <input type="text" class="input-box" id="input" placeholder="Type here..." autocomplete="off">
        
        <button onclick="changeLanguage()" class="restart-btn">RESTART TEST</button>
    </div>

    <script>
        // --- DATABASE KATA ---
        const wordBanks = {
            en: "the be to of and a in that have I it for not on with he as you do at this but his by from they we say her she or an will my one all would there their what so up out if about who get which go me when make can like time no just him know take people into year your good some could them see other than then now look only come its over think also back after use two how our work first well way even new want because any these give day most us".split(" "),
            
            id: "yang dan di aku saya kamu dia mereka kita bisa ada untuk dengan ini itu dari dalam pada juga akan sudah atau tapi karena jika ya tidak makan minum tidur kerja sekolah rumah buku tulis baca jalan lihat dengar suka cinta bahagia sedih marah takut berani kuat lemah cepat lambat besar kecil panjang pendek tinggi rendah jauh dekat bagus jelek pagi siang malam hari waktu orang dunia hidup mati temen keluarga uang pasar kantor".split(" "),
            
            jp: "ç§ ã‚ãªãŸ å½¼ å½¼å¥³ ç§ãŸã¡ ã“ã‚Œ ãã‚Œ ã‚ã‚Œ èª° ä½• ã„ã¤ ã©ã“ ãªãœ ã¯ã„ ã„ã„ãˆ è¡Œã æ¥ã‚‹ è¦‹ã‚‹ èã è©±ã™ é£Ÿã¹ã‚‹ é£²ã‚€ å¯ã‚‹ èµ·ãã‚‹ å‹‰å¼· ä»•äº‹ æ„› å¥½ã å«Œã„ å¤§ãã„ å°ã•ã„ æ–°ã—ã„ å¤ã„ è‰¯ã„ æ‚ªã„ é«˜ã„ ä½ã„ æš‘ã„ å¯’ã„ ä»Šæ—¥ æ˜æ—¥ æ˜¨æ—¥ ä»Š æ™‚é–“ å ´æ‰€ äºº ç”· å¥³ å­ä¾› å¤§äºº å‹é” å®¶æ— å­¦æ ¡ å…ˆç”Ÿ å­¦ç”Ÿ é›»è»Š è»Š æ—¥æœ¬ èª æœ¬ èª­ã‚€ æ›¸ã".split(" "),
            
            cn: "æˆ‘ ä½  ä»– å¥¹ æˆ‘ä»¬ è¿™ é‚£ è° ä»€ä¹ˆ æ—¶å€™ å“ªå„¿ ä¸ºä»€ä¹ˆ æ˜¯ ä¸ æœ‰ å» æ¥ çœ‹ å¬ è¯´ åƒ å– ç¡è§‰ èµ·åºŠ å­¦ä¹  å·¥ä½œ çˆ± å–œæ¬¢ è®¨åŒ å¤§ å° æ–° æ—§ å¥½ å é«˜ ä½ çƒ­ å†· ä»Šå¤© æ˜å¤© æ˜¨å¤© ç°åœ¨ æ—¶é—´ åœ°æ–¹ äºº ç”· å¥³ å­©å­ å¤§äºº æœ‹å‹ å®¶äºº å­¦æ ¡ è€å¸ˆ å­¦ç”Ÿ é’± ä¸œè¥¿ å¿«ä¹ éš¾è¿‡ æ¼‚äº® å¸… è°¢è°¢ å¯¹ä¸èµ·".split(" "),
            
            kr: "ë‚˜ ë„ˆ ê·¸ ê·¸ë…€ ìš°ë¦¬ ì´ê²ƒ ì €ê²ƒ ëˆ„êµ¬ ë¬´ì—‡ ì–¸ì œ ì–´ë”” ì™œ ë„¤ ì•„ë‹ˆìš” ê°€ë‹¤ ì˜¤ë‹¤ ë³´ë‹¤ ë“£ë‹¤ ë§í•˜ë‹¤ ë¨¹ë‹¤ ë§ˆì‹œë‹¤ ìë‹¤ ì¼ì–´ë‚˜ë‹¤ ê³µë¶€ ì¼ ì‚¬ë‘ ì¢‹ì•„í•˜ë‹¤ ì‹«ì–´í•˜ë‹¤ í¬ë‹¤ ì‘ë‹¤ ìƒˆë¡­ë‹¤ ì˜¤ë˜ëœ ì¢‹ë‹¤ ë‚˜ì˜ë‹¤ ë†’ë‹¤ ë‚®ë‹¤ ë¥ë‹¤ ì¶¥ë‹¤ ì˜¤ëŠ˜ ë‚´ì¼ ì–´ì œ ì§€ê¸ˆ ì‹œê°„ ì¥ì†Œ ì‚¬ëŒ ë‚¨ì ì—¬ì ì•„ì´ ì–´ë¥¸ ì¹œêµ¬ ê°€ì¡± í•™êµ ì„ ìƒë‹˜ í•™ìƒ".split(" "),
            
            th: "à¸‰à¸±à¸™ à¸„à¸¸à¸“ à¹€à¸‚à¸² à¹€à¸˜à¸­ à¹€à¸£à¸² à¸™à¸µà¹‰ à¸™à¸±à¹‰à¸™ à¹ƒà¸„à¸£ à¸­à¸°à¹„à¸£ à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆ à¸—à¸µà¹ˆà¹„à¸«à¸™ à¸—à¸³à¹„à¸¡ à¹ƒà¸Šà¹ˆ à¹„à¸¡à¹ˆ à¹„à¸› à¸¡à¸² à¸”à¸¹ à¸Ÿà¸±à¸‡ à¸à¸¹à¸” à¸à¸´à¸™ à¸”à¸·à¹ˆà¸¡ à¸™à¸­à¸™ à¸•à¸·à¹ˆà¸™ à¹€à¸£à¸µà¸¢à¸™ à¸‡à¸²à¸™ à¸£à¸±à¸ à¸Šà¸­à¸š à¹€à¸à¸¥à¸µà¸¢à¸” à¹ƒà¸«à¸à¹ˆ à¹€à¸¥à¹‡à¸ à¹ƒà¸«à¸¡à¹ˆ à¹€à¸à¹ˆà¸² à¸”à¸µ à¹€à¸¥à¸§ à¸ªà¸¹à¸‡ à¸•à¹ˆà¸³ à¸£à¹‰à¸­à¸™ à¸«à¸™à¸²à¸§ à¸§à¸±à¸™à¸™à¸µà¹‰ à¸à¸£à¸¸à¹ˆà¸‡à¸™à¸µà¹‰ à¹€à¸¡à¸·à¹ˆà¸­à¸§à¸²à¸™ à¸•à¸­à¸™à¸™à¸µà¹‰ à¹€à¸§à¸¥à¸² à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ à¸„à¸™ à¸œà¸¹à¹‰à¸Šà¸²à¸¢ à¸œà¸¹à¹‰à¸«à¸à¸´à¸‡ à¹€à¸”à¹‡à¸ à¸œà¸¹à¹‰à¹ƒà¸«à¸à¹ˆ à¹€à¸à¸·à¹ˆà¸­à¸™ à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§ à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™ à¸„à¸£à¸¹ à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™".split(" "),
            
            es: "el la de que y en un ser se no haber por con su para como estar tener le lo todo pero mÃ¡s hacer o poder decir este ir otro ese si me ya ver porque dar cuando muy sin vez mucho saber quÃ© sobre mi alguno mismo yo tambiÃ©n hasta aÃ±o dos querer entre asÃ­ primero desde grande eso ni nos llegar pasar tiempo ella sÃ­ dÃ­a".split(" "),
            
            de: "das ist du ich nicht die es und der was wir zu ein er in sie mir mit ja wie den auf mich dass so hier eine wenn hat all sind von dich war haben fÃ¼r an habe da nein bin noch dir uns sich nur einen kann dem sein jetzt leben dann vor haus mann frau kind".split(" ")
        };

        const displayDiv = document.getElementById('display');
        const inputEl = document.getElementById('input');
        const wpmEl = document.getElementById('wpm');
        const timeEl = document.getElementById('time');
        const langPicker = document.getElementById('lang-picker');

        let wordList = [];
        let currentIdx = 0;
        let isRunning = false;
        let timer = 60;
        let correctChars = 0;
        let timerInterval = null;

        // Fungsi Load Bahasa & Reset
        function changeLanguage() {
            // Reset Variable
            clearInterval(timerInterval);
            isRunning = false;
            timer = 60;
            correctChars = 0;
            currentIdx = 0;
            
            // Reset UI
            inputEl.value = "";
            inputEl.disabled = false;
            inputEl.focus();
            timeEl.innerText = "Time: 60s";
            wpmEl.innerText = "Speed: 0 WPM";
            displayDiv.scrollTop = 0;

            // Load Kata sesuai pilihan dropdown
            const selectedLang = langPicker.value;
            const source = wordBanks[selectedLang];
            
            // Generate 150 kata acak dari bank kata
            wordList = [];
            for(let i=0; i<150; i++) {
                wordList.push(source[Math.floor(Math.random() * source.length)]);
            }

            // Render HTML
            displayDiv.innerHTML = wordList.map((w, i) => `<span id="w-${i}">${w}</span>`).join(" ");
            
            // Highlight kata pertama
            document.getElementById(`w-0`).classList.add('word-active');
        }

        // --- CORE LOGIC (Sama seperti versi fix sebelumnya) ---
        inputEl.addEventListener('input', e => {
            if (!isRunning && inputEl.value.length > 0) {
                isRunning = true;
                startTimer();
            }

            const val = inputEl.value;

            // Jika spasi ditekan
            if (val.endsWith(' ')) {
                const typedWord = val.trim();
                const targetWord = wordList[currentIdx];
                const currentSpan = document.getElementById(`w-${currentIdx}`);

                // Cek Benar/Salah
                if (typedWord === targetWord) {
                    currentSpan.className = 'word-correct';
                    correctChars += targetWord.length + 1; // +1 spasi
                } else {
                    currentSpan.className = 'word-wrong';
                }

                currentIdx++;
                
                if (currentIdx < wordList.length) {
                    const nextSpan = document.getElementById(`w-${currentIdx}`);
                    nextSpan.classList.add('word-active');

                    // Auto Scroll Logic (Fixed)
                    // Jika kata baru ada di posisi > 55px dari atas visible area
                    if (nextSpan.offsetTop > displayDiv.scrollTop + 55) {
                        displayDiv.scrollTop = nextSpan.offsetTop - 10;
                    }
                }
                inputEl.value = '';
            }
        });

        function startTimer() {
            timerInterval = setInterval(() => {
                timer--;
                timeEl.innerText = `Time: ${timer}s`;
                
                const timeElapsed = (60 - timer) / 60;
                if(timeElapsed > 0) {
                    const wpm = Math.round((correctChars / 5) / timeElapsed);
                    wpmEl.innerText = `Speed: ${wpm} WPM`;
                }

                if (timer <= 0) {
                    clearInterval(timerInterval);
                    inputEl.disabled = true;
                    inputEl.value = "Test Finished!";
                    setTimeout(() => {
                        const finalWpm = Math.round((correctChars / 5));
                        alert(`Time's up!\nYour Speed (${langPicker.options[langPicker.selectedIndex].text}): ${finalWpm} WPM`);
                    }, 100);
                }
            }, 1000);
        }

        // Initialize First Load
        window.onload = changeLanguage;
    </script>
</body>
</html>
