<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GXDiag - Mobile Hub</title>
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        /* RESET & BASE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            display: flex; flex-direction: column; height: 100vh; 
            background: #050505; overflow: hidden; margin: 0;
            font-family: 'Segoe UI', 'Roboto', sans-serif; color: #eee;
        }

        /* HEADER */
        .mod-header {
            padding: 15px 20px; background: #111; border-bottom: 1px solid #333; 
            display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; z-index: 20;
        }
        .back-btn { text-decoration: none; color: #fff; font-weight: bold; display: flex; align-items: center; gap: 8px; }

        /* TABS (Sticky Top) */
        .sensor-tabs {
            display: flex; gap: 5px; padding: 10px;
            background: #0f0f0f; border-bottom: 1px solid #333; 
            flex-shrink: 0; overflow-x: auto; scrollbar-width: none;
        }
        .sensor-tabs::-webkit-scrollbar { display: none; }
        
        .tab-btn {
            background: #222; border: 1px solid #333; color: #888;
            padding: 8px 16px; border-radius: 20px; cursor: pointer; white-space: nowrap;
            font-size: 0.85rem; font-weight: bold; transition: 0.3s; flex: 1; text-align: center;
        }
        .tab-btn.active {
            background: rgba(0, 229, 255, 0.15); color: #00e5ff; border-color: #00e5ff;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.1);
        }

        /* CONTENT AREA */
        .content-area {
            flex-grow: 1; position: relative; width: 100%; overflow: hidden;
        }
        .tab-content {
            display: none; width: 100%; height: 100%;
            flex-direction: column; align-items: center; 
            padding: 20px; overflow-y: auto; padding-bottom: 80px; /* Space for scroll */
        }
        .tab-content.active { display: flex; }

        /* --- 1. BATTERY SECTION (MOBILE FRIENDLY) --- */
        .batt-wrapper {
            display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 400px;
        }
        
        /* Battery Visual - Responsive Size using vmin */
        .batt-graphic {
            width: 50vmin; height: 50vmin; max-width: 250px; max-height: 250px;
            border-radius: 50%; border: 6px solid #222;
            position: relative; margin-bottom: 25px;
            background: #111; box-shadow: inset 0 0 30px #000;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }
        
        /* The Liquid Fill */
        .batt-fill {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; /* Dynamic */
            background: linear-gradient(to top, #00e5ff, #0099ff);
            opacity: 0.6; transition: height 1s ease;
            box-shadow: 0 0 40px #00e5ff;
        }
        .batt-charging .batt-fill { background: linear-gradient(to top, #00ff88, #00cc6a); box-shadow: 0 0 40px #00ff88; }
        .batt-low .batt-fill { background: linear-gradient(to top, #ff1744, #d50000); box-shadow: 0 0 40px #ff1744; }

        /* Center Text */
        .batt-center { position: relative; z-index: 2; text-align: center; }
        .batt-val { font-size: 3.5rem; font-weight: 800; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.8); line-height: 1; }
        .batt-state { font-size: 0.9rem; color: #ccc; text-transform: uppercase; margin-top: 5px; font-weight: bold; text-shadow: 0 1px 5px rgba(0,0,0,1); }

        /* Info Grid */
        .batt-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-top: 20px;
        }
        .bg-card {
            background: #1a1a1a; padding: 15px; border-radius: 12px; border: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .bg-lbl { font-size: 0.7rem; color: #888; text-transform: uppercase; margin-bottom: 5px; }
        .bg-val { font-size: 1.1rem; color: #fff; font-weight: bold; }
        .speed-badge { padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; background: #333; color: #aaa; margin-top: 5px; }
        
        /* Note box */
        .note-box {
            margin-top: 20px; padding: 12px; background: rgba(255, 64, 129, 0.1); 
            border: 1px solid #ff4081; border-radius: 8px; color: #ff80ab; font-size: 0.75rem; text-align: center;
        }

        /* --- 2. G-FORCE & GYRO --- */
        .sensor-container { width: 100%; max-width: 400px; }
        
        .g-meter-box {
            background: #151515; border-radius: 15px; padding: 20px; border: 1px solid #333; margin-bottom: 20px;
        }
        .g-row { display: flex; align-items: center; margin-bottom: 15px; }
        .g-row:last-child { margin-bottom: 0; }
        .g-axis { width: 30px; font-weight: bold; color: #888; font-size: 0.9rem; }
        .g-bar-track { flex-grow: 1; height: 8px; background: #333; border-radius: 4px; position: relative; margin: 0 10px; overflow: hidden; }
        .g-bar { 
            position: absolute; top: 0; height: 100%; width: 50%; background: #00e5ff; 
            left: 50%; /* Center start */
            transition: width 0.1s linear, left 0.1s linear; border-radius: 4px;
        }
        .g-num { width: 40px; text-align: right; font-family: monospace; font-size: 0.9rem; color: #fff; }

        /* Hardware Audit List */
        .audit-list { width: 100%; }
        .audit-item { 
            display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #222; font-size: 0.9rem; 
        }
        .ai-ok { color: #00ff88; }
        .ai-bad { color: #ff1744; }

        /* --- 3. TOUCH --- */
        #touch-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; touch-action: none; }
        .touch-ui { position: absolute; bottom: 30px; left: 0; width: 100%; text-align: center; pointer-events: none; }
        .touch-count { font-size: 5rem; font-weight: bold; color: #333; text-shadow: 0 0 5px #000; }

        /* PERMISSION BUTTON */
        #ios-perm { 
            display: none; width: 100%; padding: 15px; background: #00e5ff; color: #000; 
            border: none; border-radius: 10px; font-weight: bold; margin-bottom: 20px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="mod-header">
        <a href="../../index.html" class="back-btn"><span>‚Üê</span> DASHBOARD</a>
        <div style="font-size:0.8rem; color:#888;">MOBILE SENSORS</div>
    </div>

    <div class="sensor-tabs">
        <button class="tab-btn active" onclick="switchTab('battery')">üîã Battery</button>
        <button class="tab-btn" onclick="switchTab('motion')">üìà Motion</button>
        <button class="tab-btn" onclick="switchTab('touch')">üëÜ Touch</button>
    </div>

    <div class="content-area">
        
        <div id="battery" class="tab-content active">
            <div class="batt-wrapper">
                
                <div class="batt-graphic" id="batt-vis">
                    <div class="batt-fill" id="batt-fill"></div>
                    <div class="batt-center">
                        <div class="batt-val" id="batt-pct">--%</div>
                        <div class="batt-state" id="batt-stat">Checking...</div>
                    </div>
                </div>

                <div class="batt-grid">
                    <div class="bg-card">
                        <div class="bg-lbl">TIME TO FULL</div>
                        <div class="bg-val" id="time-full">-</div>
                    </div>
                    <div class="bg-card">
                        <div class="bg-lbl">CHARGING SPEED</div>
                        <div class="bg-val" id="charge-speed">-</div>
                        <div class="speed-badge" id="speed-badge">ANALYZING</div>
                    </div>
                    <div class="bg-card">
                        <div class="bg-lbl">TIME LEFT</div>
                        <div class="bg-val" id="time-left">-</div>
                    </div>
                    <div class="bg-card">
                        <div class="bg-lbl">HEALTH</div>
                        <div class="bg-val" style="color:#00ff88;">GOOD</div>
                    </div>
                </div>

                <div class="note-box">
                    ‚ö†Ô∏è <b>NOTE:</b> Browser security blocks reading exact Voltage (V) & Wattage (W). Charging speed is estimated based on time-to-full data.
                </div>

            </div>
        </div>

        <div id="motion" class="tab-content">
            <button id="ios-perm" onclick="requestIOS()">Enable Sensors (iOS)</button>

            <div style="text-align:center; margin-bottom:20px;">
                <div style="color:#888; font-size:0.8rem;">TOTAL G-FORCE</div>
                <div style="font-size:2.5rem; font-weight:bold; color:#fff;" id="total-g">0.0 G</div>
            </div>

            <div class="sensor-container">
                <div class="g-meter-box">
                    <div class="g-row">
                        <div class="g-axis">X</div>
                        <div class="g-bar-track"><div class="g-bar" id="bar-x"></div></div>
                        <div class="g-num" id="val-x">0.0</div>
                    </div>
                    <div class="g-row">
                        <div class="g-axis">Y</div>
                        <div class="g-bar-track"><div class="g-bar" id="bar-y"></div></div>
                        <div class="g-num" id="val-y">0.0</div>
                    </div>
                    <div class="g-row">
                        <div class="g-axis">Z</div>
                        <div class="g-bar-track"><div class="g-bar" id="bar-z"></div></div>
                        <div class="g-num" id="val-z">0.0</div>
                    </div>
                </div>

                <div style="color:#00e5ff; font-weight:bold; margin-bottom:10px; border-bottom:1px solid #333; padding-bottom:5px;">HARDWARE AUDIT</div>
                <div class="audit-list">
                    <div class="audit-item">
                        <span>Accelerometer</span> <span id="st-acc" class="ai-bad">Waiting...</span>
                    </div>
                    <div class="audit-item">
                        <span>Gyroscope (Hardware)</span> <span id="st-gyro" class="ai-bad">Checking...</span>
                    </div>
                    <div class="audit-item">
                        <span>Update Interval</span> <span id="st-int" style="color:#fff">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="touch" class="tab-content" style="padding:0; background:#000;">
            <canvas id="touch-canvas"></canvas>
            <div class="touch-ui">
                <div style="font-size:0.8rem; color:#555;">FINGERS DETECTED</div>
                <div class="touch-count" id="touch-num">0</div>
            </div>
        </div>

    </div>

    <script>
        // --- TABS ---
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            if(id === 'touch') resizeCanvas();
        }

        // --- 1. BATTERY LOGIC (With Charging Speed Estimator) ---
        function updateBattery(b) {
            const level = b.level * 100;
            const isCharging = b.charging;
            
            // Visual Update
            document.getElementById('batt-pct').innerText = Math.round(level) + "%";
            document.getElementById('batt-fill').style.height = level + "%";
            
            const vis = document.getElementById('batt-vis');
            const stat = document.getElementById('batt-stat');

            if(isCharging) {
                vis.classList.add('batt-charging');
                vis.classList.remove('batt-low');
                stat.innerText = "‚ö° CHARGING";
                stat.style.color = "#00ff88";
            } else {
                vis.classList.remove('batt-charging');
                if(level < 20) vis.classList.add('batt-low');
                stat.innerText = "DISCHARGING";
                stat.style.color = "#ccc";
            }

            // Time Calculations
            const tFull = b.chargingTime;
            const tLeft = b.dischargingTime;

            document.getElementById('time-full').innerText = tFull === Infinity || tFull === 0 ? "-" : (tFull/60).toFixed(0)+" min";
            document.getElementById('time-left').innerText = tLeft === Infinity ? "-" : (tLeft/3600).toFixed(1)+" hrs";

            // CHARGING SPEED ESTIMATION LOGIC
            const badge = document.getElementById('speed-badge');
            const speedVal = document.getElementById('charge-speed');

            if (isCharging) {
                if (tFull === Infinity) {
                    speedVal.innerText = "Calculating...";
                    badge.innerText = "WAIT...";
                    badge.style.color = "#aaa";
                } else {
                    // Logic: Calculate % per minute based on time remaining to 100%
                    // remaining % = 100 - level
                    // rate = remaining % / (tFull in minutes)
                    const remainingPct = 100 - level;
                    const minutesLeft = tFull / 60;
                    const rate = remainingPct / minutesLeft; // % per minute

                    if(rate > 1.5) { 
                        speedVal.innerText = "SUPER FAST"; 
                        badge.innerText = "PD / QC 3.0+";
                        badge.style.color = "#00e5ff";
                    } else if (rate > 0.8) {
                        speedVal.innerText = "FAST";
                        badge.innerText = "Standard Fast";
                        badge.style.color = "#00ff88";
                    } else {
                        speedVal.innerText = "NORMAL";
                        badge.innerText = "Standard 5V";
                        badge.style.color = "#ffb300";
                    }
                }
            } else {
                speedVal.innerText = "ON BATTERY";
                badge.innerText = "IDLE";
                badge.style.color = "#888";
            }
        }

        if ('getBattery' in navigator) {
            navigator.getBattery().then(b => {
                updateBattery(b);
                b.addEventListener('levelchange', () => updateBattery(b));
                b.addEventListener('chargingchange', () => updateBattery(b));
            });
        }

        // --- 2. MOTION LOGIC ---
        function handleMotion(e) {
            // Hardware Check
            document.getElementById('st-acc').innerText = "DETECTED ‚úÖ";
            document.getElementById('st-acc').className = "ai-ok";
            document.getElementById('st-int').innerText = e.interval.toFixed(1) + " ms";

            // Gyro Check (Rotation Rate is key)
            if(e.rotationRate && e.rotationRate.alpha !== null) {
                document.getElementById('st-gyro').innerText = "TRUE HARDWARE ‚úÖ";
                document.getElementById('st-gyro').className = "ai-ok";
            } else {
                document.getElementById('st-gyro').innerText = "VIRTUAL / NONE ‚ö†Ô∏è";
                document.getElementById('st-gyro').className = "ai-bad";
            }

            // G-Force Calc
            let x = e.accelerationIncludingGravity.x || 0;
            let y = e.accelerationIncludingGravity.y || 0;
            let z = e.accelerationIncludingGravity.z || 0;
            
            let total = Math.sqrt(x*x + y*y + z*z) / 9.8;
            document.getElementById('total-g').innerText = total.toFixed(1) + " G";

            // Bars Update
            updateBar('val-x', 'bar-x', x);
            updateBar('val-y', 'bar-y', y);
            updateBar('val-z', 'bar-z', z);
        }

        function updateBar(txtId, barId, val) {
            document.getElementById(txtId).innerText = val.toFixed(1);
            let pct = (val / 20) * 100; // Map +/- 20 range
            let width = Math.abs(pct);
            let left = 50;
            if (val < 0) left = 50 - width;
            
            const bar = document.getElementById(barId);
            bar.style.width = Math.min(width, 50) + "%";
            bar.style.left = left + "%";
        }

        if (window.DeviceMotionEvent) window.addEventListener('devicemotion', handleMotion);

        // iOS Permission
        function requestIOS() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(r => {
                    if (r == 'granted') {
                        window.addEventListener('devicemotion', handleMotion);
                        document.getElementById('ios-perm').style.display = 'none';
                    }
                });
            }
        }
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
            document.getElementById('ios-perm').style.display = 'block';
        }

        // --- 3. TOUCH LOGIC ---
        const canvas = document.getElementById('touch-canvas');
        const ctx = canvas.getContext('2d');
        const touchNum = document.getElementById('touch-num');
        const colors = ['#00e5ff', '#ff4081', '#00ff88', '#ffff00', '#ff9100'];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);

        function drawTouches(e) {
            e.preventDefault();
            ctx.clearRect(0,0,canvas.width,canvas.height);
            const touches = e.touches;
            touchNum.innerText = touches.length;

            for(let i=0; i<touches.length; i++) {
                const t = touches[i];
                const col = colors[i % colors.length];
                
                ctx.beginPath();
                ctx.arc(t.clientX, t.clientY, 40, 0, 2 * Math.PI);
                ctx.strokeStyle = col;
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.fillStyle = col;
                ctx.font = "bold 20px Arial";
                ctx.fillText(i+1, t.clientX-5, t.clientY+5);
            }
        }
        canvas.addEventListener('touchstart', drawTouches);
        canvas.addEventListener('touchmove', drawTouches);
        canvas.addEventListener('touchend', (e) => {
            drawTouches(e);
            if(e.touches.length === 0) ctx.clearRect(0,0,canvas.width,canvas.height);
        });

    </script>
</body>
</html>
