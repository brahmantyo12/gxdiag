<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GXDiag - Image Resizer</title>
    <meta name="theme-color" content="#1a1a1a">
    
    <link rel="stylesheet" href="../../css/style.css">

    <style>
        body { background: #111; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 950px; margin: 0 auto; }
        
        /* Header */
        .module-header { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .back-btn { text-decoration: none; color: #888; font-size: 1.1rem; transition: 0.2s; }
        .back-btn:hover { color: #fff; }
        .module-title { font-size: 1.5rem; font-weight: 800; color: #00e5ff; text-transform: uppercase; letter-spacing: 2px; }

        /* Grid Layout */
        .resizer-grid { display: grid; grid-template-columns: 1fr 320px; gap: 25px; align-items: start; }
        @media (max-width: 850px) { .resizer-grid { grid-template-columns: 1fr; } }

        /* Drop Zone & Preview */
        .drop-zone {
            background: #1a1a1a; border: 2px dashed #444; border-radius: 15px;
            padding: 20px; text-align: center; transition: 0.3s; cursor: pointer;
            min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden; position: relative;
        }
        .drop-zone:hover { border-color: #00e5ff; background: rgba(0, 229, 255, 0.05); }
        .drop-zone img { max-width: 100%; max-height: 500px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); display: none; }

        /* Control Panel */
        .control-panel { background: #1a1a1a; border: 1px solid #333; padding: 20px; border-radius: 12px; }
        
        .section-title { font-size: 0.8rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }

        /* Quick Buttons */
        .quick-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .q-btn {
            background: #222; border: 1px solid #444; color: #ccc; padding: 8px; border-radius: 6px;
            cursor: pointer; font-size: 0.8rem; font-weight: bold; transition: 0.2s;
        }
        .q-btn:hover { background: #00e5ff; color: #000; border-color: #00e5ff; }

        /* Dimension Inputs */
        .dim-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .dim-input-wrapper { flex: 1; position: relative; }
        .dim-input-wrapper input {
            width: 100%; background: #000; border: 1px solid #444; color: #00e5ff;
            padding: 10px; border-radius: 6px; font-family: monospace; font-size: 1.1rem; text-align: center;
        }
        .dim-label { position: absolute; top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px; font-size: 0.7rem; color: #888; }
        
        .link-icon { font-size: 1.2rem; color: #555; cursor: pointer; transition: 0.2s; }
        .link-icon.locked { color: #00e5ff; }

        /* Settings */
        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 0.9rem; }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #00e5ff; }
        input:checked + .slider:before { transform: translateX(18px); }

        /* Info Box */
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #111; padding: 10px; border-radius: 8px; margin-bottom: 20px; }
        .info-item { text-align: center; }
        .info-lbl { font-size: 0.7rem; color: #666; }
        .info-val { font-size: 0.9rem; color: #fff; font-weight: bold; }
        .val-new { color: #00e5ff; }

        /* Download Button */
        .btn-download {
            background: linear-gradient(135deg, #00b0ff, #00e5ff); color: #000;
            width: 100%; padding: 15px; border: none; border-radius: 8px;
            font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.2s;
            text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-download:hover { box-shadow: 0 0 20px rgba(0, 229, 255, 0.4); transform: translateY(-2px); }
        .btn-download:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }

    </style>
</head>
<body>

    <div class="container">
        <div class="module-header">
            <a href="../../index.html" class="back-btn">‚¨Ö Dashboard</a>
            <div class="module-title">Resizer & Upscaler</div>
        </div>

        <div class="resizer-grid">
            
            <div>
                <div class="drop-zone" id="drop-zone" onclick="document.getElementById('file-input').click()">
                    <div id="dz-text" style="text-align:center;">
                        <div style="font-size:3rem; margin-bottom:10px;">üìè</div>
                        <div style="font-weight:bold; color:#ccc;">Select Image to Resize</div>
                    </div>
                    <img id="preview-img" alt="Preview">
                    <input type="file" id="file-input" accept="image/*" style="display:none;">
                </div>
            </div>

            <div class="control-panel">
                
                <div class="section-title">Quick Presets</div>
                <div class="quick-actions">
                    <button class="q-btn" onclick="applyPreset(0.5)">0.5x</button>
                    <button class="q-btn" onclick="applyPreset(0.75)">75%</button>
                    <button class="q-btn" onclick="applyPreset(2.0)" style="color:#00ff88; border-color:#00ff88;">2x AI*</button>
                </div>

                <div class="section-title">Dimensions (px)</div>
                <div class="dim-group">
                    <div class="dim-input-wrapper">
                        <span class="dim-label">WIDTH</span>
                        <input type="number" id="inp-width" oninput="manualResize('w')">
                    </div>
                    <div class="link-icon locked" id="link-ratio" onclick="toggleRatio()" title="Lock Aspect Ratio">üîó</div>
                    <div class="dim-input-wrapper">
                        <span class="dim-label">HEIGHT</span>
                        <input type="number" id="inp-height" oninput="manualResize('h')">
                    </div>
                </div>

                <div class="section-title">Settings</div>
                <div class="setting-row">
                    <span>Pixel Art Mode (Sharp)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="pixel-mode" onchange="renderPreview()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div style="font-size:0.75rem; color:#666; margin-top:-10px; margin-bottom:20px;">
                    Enable this for retro game assets to keep edges sharp when upscaling (Nearest Neighbor).
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-lbl">Original</div>
                        <div class="info-val" id="res-origin">- x -</div>
                    </div>
                    <div class="info-item">
                        <div class="info-lbl">New Output</div>
                        <div class="info-val val-new" id="res-new">- x -</div>
                    </div>
                </div>

                <button class="btn-download" id="btn-dl" onclick="downloadImage()" disabled>
                    ‚¨á Save Resized Image
                </button>

            </div>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const previewImg = document.getElementById('preview-img');
        const inpWidth = document.getElementById('inp-width');
        const inpHeight = document.getElementById('inp-height');
        const linkRatio = document.getElementById('link-ratio');
        const pixelMode = document.getElementById('pixel-mode');
        
        let originalW = 0;
        let originalH = 0;
        let aspectRatio = 0;
        let isRatioLocked = true;
        let fileType = "image/png";
        let fileName = "image";

        // --- Drag & Drop ---
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('active'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('active'));
        dropZone.addEventListener('drop', (e) => { 
            e.preventDefault(); 
            handleFile(e.dataTransfer.files[0]); 
        });
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) return;
            
            fileType = file.type;
            fileName = file.name.substring(0, file.name.lastIndexOf('.'));
            
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
                document.getElementById('dz-text').style.display = 'none';
                
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    originalW = img.width;
                    originalH = img.height;
                    aspectRatio = originalW / originalH;
                    
                    document.getElementById('res-origin').innerText = `${originalW} x ${originalH}`;
                    
                    // Set inputs to original
                    inpWidth.value = originalW;
                    inpHeight.value = originalH;
                    updateInfo();
                    
                    document.getElementById('btn-dl').disabled = false;
                }
            };
            reader.readAsDataURL(file);
        }

        // --- Resize Logic ---
        function toggleRatio() {
            isRatioLocked = !isRatioLocked;
            linkRatio.className = isRatioLocked ? "link-icon locked" : "link-icon";
            // Jika dikunci kembali, reset tinggi sesuai rasio lebar saat ini
            if(isRatioLocked && inpWidth.value) {
                inpHeight.value = Math.round(inpWidth.value / aspectRatio);
                updateInfo();
            }
        }

        function manualResize(source) {
            if (!originalW) return;
            
            let w = parseInt(inpWidth.value);
            let h = parseInt(inpHeight.value);

            if (isRatioLocked) {
                if (source === 'w' && w) {
                    inpHeight.value = Math.round(w / aspectRatio);
                } else if (source === 'h' && h) {
                    inpWidth.value = Math.round(h * aspectRatio);
                }
            }
            updateInfo();
        }

        function applyPreset(multiplier) {
            if (!originalW) return;
            inpWidth.value = Math.round(originalW * multiplier);
            inpHeight.value = Math.round(originalH * multiplier);
            updateInfo();
        }

        function updateInfo() {
            document.getElementById('res-new').innerText = `${inpWidth.value} x ${inpHeight.value}`;
        }

        // --- Processing & Download ---
        function downloadImage() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const w = parseInt(inpWidth.value);
            const h = parseInt(inpHeight.value);

            canvas.width = w;
            canvas.height = h;

            // Image Smoothing Logic (Bilinear vs Nearest Neighbor)
            if (pixelMode.checked) {
                ctx.imageSmoothingEnabled = false; // Pixelated (Retro style)
            } else {
                ctx.imageSmoothingEnabled = true;  // Smooth (Photo style)
                ctx.imageSmoothingQuality = 'high';
            }

            ctx.drawImage(previewImg, 0, 0, w, h);

            // Convert & Download
            const dataUrl = canvas.toDataURL(fileType, 0.9); // 0.9 quality
            const link = document.createElement('a');
            link.download = `${fileName}-resized-${w}x${h}.png`; // Force PNG for safe transparency support
            if(fileType === "image/jpeg") link.download = `${fileName}-resized-${w}x${h}.jpg`;
            
            link.href = dataUrl;
            link.click();
        }

        // Dummy function for checkbox linkage (UI only)
        function renderPreview() {
            // In a pro version, we would update the visual preview.
            // For now, it just sets the flag for the downloader.
        }
    </script>
</body>
</html>
