<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GXDiag - Audio</title>
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        body { background: #0a0a0a; color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .mod-header { padding: 15px; background: #111; border-bottom: 1px solid #333; }
        .back-btn { text-decoration: none; color: #fff; font-weight: bold; }
        
        .container { flex-grow: 1; padding: 20px; display: flex; flex-direction: column; gap: 30px; align-items: center; justify-content: center; }
        
        /* STEREO BOX */
        .stereo-box { display: flex; gap: 20px; }
        .spk-btn { padding: 20px 40px; background: #222; border: 1px solid #444; color: #fff; cursor: pointer; border-radius: 8px; font-weight: bold; }
        .spk-btn:active { background: #00e5ff; color: #000; }

        /* FREQUENCY GEN */
        .freq-box { width: 100%; max-width: 500px; background: #151515; padding: 20px; border-radius: 10px; border: 1px solid #333; text-align: center; }
        .range-slider { width: 100%; margin: 15px 0; }
        .freq-display { font-size: 2rem; color: #00e5ff; font-family: monospace; }
        .play-tone-btn { background: #ff4081; border: none; padding: 10px 30px; color: #fff; border-radius: 20px; cursor: pointer; font-weight: bold; }
        
        /* MIC */
        .mic-bar { width: 20px; height: 100px; background: #333; border-radius: 10px; position: relative; overflow: hidden; margin: 0 auto; }
        .mic-fill { position: absolute; bottom: 0; width: 100%; height: 0%; background: #00ff88; transition: height 0.1s; }
    </style>
</head>
<body>
    <div class="mod-header"><a href="../../index.html" class="back-btn">‚Üê DASHBOARD</a></div>

    <div class="container">
        <div>
            <h3>Stereo Test</h3>
            <div class="stereo-box">
                <button class="spk-btn" onclick="playTone(0)">LEFT</button>
                <button class="spk-btn" onclick="playTone(1)">RIGHT</button>
            </div>
        </div>

        <div class="freq-box">
            <h3>Frequency Sweep</h3>
            <div class="freq-display"><span id="freq-val">440</span> Hz</div>
            <input type="range" min="20" max="20000" value="440" class="range-slider" id="freq-slider" oninput="updateFreq(this.value)">
            <button class="play-tone-btn" id="btn-tone" onclick="toggleOscillator()">START TONE</button>
        </div>

        <div style="text-align:center;">
            <h3>Microphone</h3>
            <div class="mic-bar"><div class="mic-fill" id="mic-level"></div></div>
            <button style="margin-top:10px; padding:5px 15px;" onclick="initMic()">Enable Mic</button>
        </div>
    </div>

    <script>
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        
        // STEREO
        function playTone(panVal) {
            const osc = ctx.createOscillator();
            const panner = ctx.createStereoPanner();
            osc.connect(panner);
            panner.connect(ctx.destination);
            panner.pan.value = panVal === 0 ? -1 : 1;
            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        }

        // FREQ GEN
        let osc = null;
        const slider = document.getElementById('freq-slider');
        const disp = document.getElementById('freq-val');
        const btn = document.getElementById('btn-tone');

        function updateFreq(val) {
            disp.innerText = val;
            if(osc) osc.frequency.value = val;
        }

        function toggleOscillator() {
            if(osc) {
                osc.stop(); osc = null;
                btn.innerText = "START TONE";
                btn.style.background = "#ff4081";
            } else {
                osc = ctx.createOscillator();
                osc.type = 'sine';
                osc.frequency.value = slider.value;
                osc.connect(ctx.destination);
                osc.start();
                btn.innerText = "STOP TONE";
                btn.style.background = "#333";
            }
        }

        // MIC
        async function initMic() {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const source = ctx.createMediaStreamSource(stream);
            const analyser = ctx.createAnalyser();
            source.connect(analyser);
            const data = new Uint8Array(analyser.frequencyBinCount);
            
            function loop() {
                analyser.getByteFrequencyData(data);
                const vol = data.reduce((a,b)=>a+b) / data.length;
                document.getElementById('mic-level').style.height = (vol * 2) + "%";
                requestAnimationFrame(loop);
            }
            loop();
        }
    </script>
</body>
</html>
