<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GXDiag - Cipher Ops Universal</title>
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        body { 
            background: #0b0b0b; display: flex; flex-direction: column; height: 100vh; overflow: hidden; 
            font-family: 'Segoe UI', monospace; color: #eee;
        }
        
        .mod-header { 
            padding: 15px 20px; background: #111; border-bottom: 1px solid #333; 
            display: flex; justify-content: space-between; align-items: center; 
        }
        .back-btn { text-decoration: none; color: #fff; font-weight: bold; }
        .header-title { font-size: 0.9rem; color: #00e5ff; letter-spacing: 2px; font-weight: bold; }

        .container {
            flex-grow: 1; display: flex; flex-direction: column; gap: 15px; 
            padding: 20px; max-width: 1000px; margin: 0 auto; width: 100%; overflow-y: auto;
        }

        /* FLEXIBLE GRID */
        .trans-engine {
            display: grid; grid-template-columns: 1fr 50px 1fr; gap: 10px; height: 100%;
        }

        /* CARD STYLE */
        .io-card {
            background: #111; border: 1px solid #333; border-radius: 12px;
            display: flex; flex-direction: column; overflow: hidden;
            transition: 0.3s;
        }
        .io-card:focus-within { border-color: #00e5ff; box-shadow: 0 0 15px rgba(0, 229, 255, 0.1); }

        /* HEADER CARD */
        .card-head {
            background: #181818; padding: 10px 15px; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        /* DROPDOWN STYLING */
        select {
            background: #000; color: #00e5ff; border: 1px solid #333; padding: 5px 10px;
            border-radius: 5px; font-weight: bold; font-family: monospace; outline: none; cursor: pointer;
            max-width: 150px; /* Agar tidak terlalu lebar di HP */
        }

        /* TEXTAREA */
        textarea {
            flex-grow: 1; background: #0b0b0b; border: none; color: #fff;
            padding: 15px; resize: none; font-family: 'Consolas', monospace; font-size: 1.1rem; outline: none;
        }
        
        /* MIDDLE CONTROLS */
        .mid-ctrl {
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px;
        }
        .swap-btn {
            background: #222; border: 1px solid #444; color: #fff; width: 40px; height: 40px;
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; transition: 0.3s;
        }
        .swap-btn:hover { background: #00e5ff; color: #000; transform: rotate(180deg); }

        /* FOOTER ACTIONS */
        .card-foot {
            padding: 10px 15px; border-top: 1px solid #333; display: flex; gap: 10px; justify-content: flex-end;
        }
        .act-btn {
            background: transparent; border: 1px solid #444; color: #888; padding: 5px 12px;
            border-radius: 20px; cursor: pointer; font-size: 0.75rem; font-weight: bold; display: flex; align-items: center; gap: 5px;
        }
        .act-btn:hover { border-color: #fff; color: #fff; }
        .act-btn.mic.active { background: #ff4081; color: #fff; border-color: #ff4081; animation: pulse 1.5s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- RESPONSIVE & TOUCH OPTIMIZATION --- */
        @media (max-width: 768px) {
            /* Ubah layout jadi Atas-Bawah */
            .trans-engine { grid-template-columns: 1fr; grid-template-rows: 1fr 60px 1fr; }
            
            /* Kontrol tengah jadi horizontal */
            .mid-ctrl { flex-direction: row; }
            
            /* Tombol Swap diputar agar panahnya benar (Atas-Bawah) */
            .swap-btn { transform: rotate(90deg); width: 50px; height: 50px; font-size: 1.5rem; }
            .swap-btn:hover { transform: rotate(270deg); }
            
            /* Perbesar tombol aksi agar mudah disentuh jempol */
            .act-btn { padding: 10px 15px; font-size: 0.85rem; }
            
            /* Perbesar dropdown */
            select { padding: 8px; font-size: 0.9rem; max-width: 120px; }
        }
    </style>
</head>
<body>

    <div class="mod-header">
        <a href="../../index.html" class="back-btn">‚Üê DASHBOARD</a>
        <div class="header-title">CIPHER OPS</div>
    </div>

    <div class="container">
        
        <div class="trans-engine">
            
            <div class="io-card">
                <div class="card-head">
                    <select id="sel-in" onchange="runConvert()">
                        <optgroup label="Languages (Online)">
                            <option value="text_id">üáÆüá© INDONESIA</option>
                            <option value="text_en" selected>üá∫üá∏ ENGLISH</option>
                        </optgroup>
                        <optgroup label="Codes & Ciphers">
                            <option value="morse">üì° MORSE CODE</option>
                            <option value="binary">ü§ñ BINARY</option>
                            <option value="hex">üß¨ HEXADECIMAL</option>
                            <option value="base64">üì¶ BASE64</option>
                            <option value="rot13">üîÑ ROT13</option>
                        </optgroup>
                    </select>
                    <button class="act-btn mic" id="mic-btn" onclick="toggleMic()">üé§</button>
                </div>
                <textarea id="txt-in" placeholder="Input here..." oninput="runConvert()"></textarea>
                <div class="card-foot">
                    <button class="act-btn" onclick="pasteIn()">üìã PASTE</button>
                    <button class="act-btn" onclick="clearAll()">‚úï CLEAR</button>
                </div>
            </div>

            <div class="mid-ctrl">
                <button class="swap-btn" onclick="swapSides()">‚áÑ</button>
            </div>

            <div class="io-card">
                <div class="card-head">
                    <select id="sel-out" onchange="runConvert()">
                        <optgroup label="Languages (Online)">
                            <option value="text_id">üáÆüá© INDONESIA</option>
                            <option value="text_en">üá∫üá∏ ENGLISH</option>
                        </optgroup>
                        <optgroup label="Codes & Ciphers">
                            <option value="morse" selected>üì° MORSE CODE</option>
                            <option value="binary">ü§ñ BINARY</option>
                            <option value="hex">üß¨ HEXADECIMAL</option>
                            <option value="base64">üì¶ BASE64</option>
                            <option value="rot13">üîÑ ROT13</option>
                        </optgroup>
                    </select>
                    <button class="act-btn" onclick="playAudio()">‚ñ∂ PLAY</button>
                </div>
                <textarea id="txt-out" placeholder="Result..." readonly></textarea>
                <div class="card-foot">
                    <button class="act-btn" onclick="copyOut()">üìã COPY RESULT</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const txtIn = document.getElementById('txt-in');
        const txtOut = document.getElementById('txt-out');
        const selIn = document.getElementById('sel-in');
        const selOut = document.getElementById('sel-out');

        // --- DICTIONARIES ---
        const MORSE = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.',
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..',
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.',
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
            'Y': '-.--', 'Z': '--..', '1': '.----', '2': '..---', '3': '...--',
            '4': '....-', '5': '.....', '6': '-....', '7': '--...', '8': '---..',
            '9': '----.', '0': '-----', ' ': '/', '.':'.-.-.-', ',':'--..--', '?':'..--..', '!':'-.-.--'
        };
        const REV_MORSE = Object.fromEntries(Object.entries(MORSE).map(([k, v]) => [v, k]));

        // --- CORE LOGIC: ANY to ANY ---
        
        let debounceTimer;

        async function runConvert() {
            clearTimeout(debounceTimer);
            const inputVal = txtIn.value;
            const inMode = selIn.value;
            const outMode = selOut.value;

            if(!inputVal) { txtOut.value = ""; return; }

            // 1. DECODE INPUT TO PLAIN TEXT (INTERMEDIATE)
            let plainText = "";
            try {
                if (inMode.startsWith('text')) {
                    plainText = inputVal; 
                } else if (inMode === 'morse') {
                    plainText = inputVal.split(' ').map(c => REV_MORSE[c] || '').join('');
                } else if (inMode === 'binary') {
                    plainText = inputVal.split(' ').map(b => String.fromCharCode(parseInt(b, 2))).join('');
                } else if (inMode === 'hex') {
                    plainText = inputVal.split(' ').map(h => String.fromCharCode(parseInt(h, 16))).join('');
                } else if (inMode === 'base64') {
                    plainText = atob(inputVal);
                } else if (inMode === 'rot13') {
                    plainText = rot13(inputVal);
                }
            } catch (e) {
                txtOut.value = "Error Decoding Input";
                return;
            }

            // 2. CHECK IF TRANSLATION IS NEEDED (Language to Language)
            // Using Free API (MyMemory) - Client Side
            if (inMode.startsWith('text_') && outMode.startsWith('text_') && inMode !== outMode) {
                txtOut.value = "Translating...";
                debounceTimer = setTimeout(() => translateLanguage(plainText, inMode, outMode), 800);
                return;
            }

            // 3. ENCODE PLAIN TEXT TO OUTPUT
            let result = "";
            try {
                if (outMode.startsWith('text')) {
                    result = plainText; // Just passthrough if same lang or from code
                } else if (outMode === 'morse') {
                    result = plainText.toUpperCase().split('').map(c => MORSE[c] || c).join(' ');
                } else if (outMode === 'binary') {
                    result = plainText.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' ');
                } else if (outMode === 'hex') {
                    result = plainText.split('').map(c => c.charCodeAt(0).toString(16).toUpperCase().padStart(2, '0')).join(' ');
                } else if (outMode === 'base64') {
                    result = btoa(plainText);
                } else if (outMode === 'rot13') {
                    result = rot13(plainText);
                }
                txtOut.value = result;
            } catch (e) {
                txtOut.value = "Error Encoding Output";
            }
        }

        // --- HELPER FUNCTIONS ---
        
        function rot13(str) {
            return str.replace(/[a-zA-Z]/g, c => String.fromCharCode((c <= "Z" ? 90 : 122) >= (c = c.charCodeAt(0) + 13) ? c : c - 26));
        }

        // LANGUAGE TRANSLATION (Free API)
        async function translateLanguage(text, source, target) {
            const langPair = `${source.split('_')[1]}|${target.split('_')[1]}`; // e.g. "en|id"
            const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${langPair}`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                if(data.responseStatus === 200) {
                    txtOut.value = data.responseData.translatedText;
                } else {
                    txtOut.value = "Translation Limit / Error";
                }
            } catch(e) {
                txtOut.value = "Offline / Connection Error";
            }
        }

        // --- UI ACTIONS ---

        function swapSides() {
            const tempVal = txtIn.value;
            const tempMode = selIn.value;
            
            if(txtOut.value) txtIn.value = txtOut.value;
            
            selIn.value = selOut.value;
            selOut.value = tempMode;
            
            runConvert();
        }

        function clearAll() { txtIn.value = ""; txtOut.value = ""; }
        async function pasteIn() { txtIn.value = await navigator.clipboard.readText(); runConvert(); }
        function copyOut() { navigator.clipboard.writeText(txtOut.value); alert("Copied!"); }

        // --- SPEECH RECOGNITION ---
        let recognition;
        let isListening = false;
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.onresult = (e) => {
                txtIn.value += " " + e.results[0][0].transcript;
                runConvert();
                toggleMic(false);
            };
            recognition.onend = () => toggleMic(false);
        }

        function toggleMic(forceState) {
            if(!recognition) return alert("Browser not supported");
            const btn = document.getElementById('mic-btn');
            
            if(forceState === false || isListening) {
                recognition.stop();
                isListening = false;
                btn.classList.remove('active');
            } else {
                // Set lang based on input selection
                const lang = selIn.value === 'text_id' ? 'id-ID' : 'en-US';
                recognition.lang = lang;
                recognition.start();
                isListening = true;
                btn.classList.add('active');
            }
        }

        // --- AUDIO PLAYER (MORSE) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        async function playAudio() {
            if(selOut.value !== 'morse') {
                // If text, try Text-to-Speech
                if(selOut.value.startsWith('text')) {
                    const utter = new SpeechSynthesisUtterance(txtOut.value);
                    utter.lang = selOut.value === 'text_id' ? 'id-ID' : 'en-US';
                    window.speechSynthesis.speak(utter);
                }
                return;
            }

            // Morse Playback Logic
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const code = txtOut.value;
            const DOT = 80;

            for (const char of code) {
                if (char === ' ') { await wait(DOT * 3); continue; }
                if (char === '/') { await wait(DOT * 7); continue; }

                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine'; osc.frequency.value = 600;
                osc.connect(gain); gain.connect(audioCtx.destination);

                const dur = (char === '.') ? DOT : (char === '-') ? DOT * 3 : 0;
                if(dur > 0) {
                    osc.start();
                    gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + (dur/1000));
                    await wait(dur);
                    osc.stop();
                    await wait(DOT);
                }
            }
        }
        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

    </script>
</body>
</html>
