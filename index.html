<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Keyboard Tester + Sound</title>
    <style>
        /* --- RESET & DASAR --- */
        * { box-sizing: border-box; }
        body {
            background-color: #1a1a1a;
            color: #eee;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: start;
            padding-top: 20px;
            min-height: 100vh;
            margin: 0;
            user-select: none; /* Supaya teks tidak terblok saat klik cepat */
        }

        /* --- HEADER & CONTROLS --- */
        .header-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        h2 { margin: 0; color: #00ff88; text-transform: uppercase; letter-spacing: 2px; }

        /* TOGGLE SWITCH STYLE */
        .sound-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #333;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #444;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #555;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #00ff88; }
        input:checked + .slider:before { transform: translateX(20px); }
        .sound-label { font-size: 0.9rem; font-weight: bold; color: #fff; }

        /* --- PROGRESS BAR --- */
        .progress-text { text-align: center; font-size: 0.9rem; color: #ccc; margin-bottom: 5px; margin-top: 10px;}
        .progress-container {
            width: 100%; max-width: 1250px; background: #333; height: 8px;
            border-radius: 5px; margin-bottom: 20px; overflow: hidden;
        }
        .progress-bar { height: 100%; background: #00ff88; width: 0%; transition: width 0.3s; }

        /* --- KEYBOARD UI --- */
        .keyboard-case {
            background: #2b2b2b; padding: 20px; border-radius: 15px;
            border-bottom: 10px solid #111; box-shadow: 0 30px 60px rgba(0,0,0,0.6);
            display: flex; flex-direction: column; gap: 15px; max-width: 1250px; margin-bottom: 20px;
        }
        /* Style Baris & Tombol (Sama seperti V5) */
        .media-row { display: flex; justify-content: center; gap: 20px; padding-bottom: 10px; border-bottom: 2px solid #333; margin-bottom: 5px; }
        .media-group { display: flex; gap: 6px; align-items: center; }
        .key.media { height: 35px; width: 45px; font-size: 16px; border-radius: 20px; background: #333; }
        .function-row { display: flex; gap: 45px; padding-left: 5px; }
        .f-group { display: flex; gap: 6px; }
        .keyboard-body { display: flex; gap: 15px; }
        .main-block { display: flex; flex-direction: column; gap: 6px; }
        .row { display: flex; gap: 6px; }
        .nav-block { display: flex; flex-direction: column; justify-content: space-between; width: 160px; }
        .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .numpad-block { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, 50px); gap: 6px; width: 210px; }

        .key {
            height: 50px; width: 50px; background: #444; border-bottom: 4px solid #333;
            border-radius: 4px; color: #fff; display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; cursor: default; transition: all 0.05s;
            text-align: center; line-height: 1.1;
        }
        .key.active { 
            background: #fff; color: #111; border-bottom: 2px solid #ccc; 
            transform: translateY(2px); box-shadow: 0 0 20px #fff; z-index: 10;
        }
        .key.tested { background: #00552e; color: #88ffbb; border-color: #00331a; }
        .key.tested.active { background: #00ff88; color: #111; box-shadow: 0 0 15px #00ff88; }

        .w-2 { width: 75px; } .w-3 { width: 90px; } .w-4 { width: 115px; } .w-5 { width: 65px; } .w-space { width: 318px; } .w-full { flex-grow: 1; }
        .h-2 { grid-row: span 2; height: 106px; } .w-num-0 { grid-column: span 2; width: 106px; }

        /* --- DASHBOARD --- */
        .dashboard {
            width: 90%; max-width: 1250px; display: grid;
            grid-template-columns: 1fr 1fr 1fr; gap: 15px; align-items: start;
        }
        .panel {
            background: #111; border: 1px solid #333; border-radius: 8px;
            padding: 15px; height: 200px; display: flex; flex-direction: column;
        }
        .panel-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px;
            color: #fff; font-weight: bold; font-size: 0.9rem;
        }
        #key-history { flex-grow: 1; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 5px; align-content: flex-start; }
        .log-item { background: #222; color: #00ff88; padding: 4px 8px; border-radius: 4px; font-size: 12px; border: 1px solid #333; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; height: 100%; }
        .stat-box { background: #222; border-radius: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .stat-val { font-size: 2rem; color: #00ff88; font-weight: bold; font-family: monospace; }
        .stat-lbl { font-size: 0.7rem; color: #aaa; text-transform: uppercase; margin-top: 5px; }
        .ghosting-display { flex-grow: 1; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .ghost-val { font-size: 5rem; font-weight: bold; color: #fff; line-height: 1; }
        .ghost-lbl { color: #888; font-size: 0.9rem; }
        .ghost-max { font-size: 0.8rem; color: #555; margin-top: 5px; }
        button { cursor: pointer; background: #444; color: white; border: none; padding: 4px 10px; border-radius: 3px; }
        button:hover { background: #666; }
        .btn-reset { background: #d32f2f; } .btn-reset:hover { background: #b71c1c; }
    </style>
</head>
<body>

    <div class="header-container">
        <h2>Ultimate Keyboard Tester</h2>
        
        <div class="sound-control">
            <span class="sound-label">üîä Suara:</span>
            <label class="switch">
                <input type="checkbox" id="sound-toggle" checked>
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <div class="progress-text">Progress: <span id="progress-percent">0%</span></div>
    <div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
    
    <div class="keyboard-case">
        <div class="media-row">
            <div class="media-group"><div class="key media" data-code="BrowserHome">üè†</div><div class="key media" data-code="LaunchMail">‚úâ</div><div class="key media" data-code="Calculator">üßÆ</div></div>
            <div class="media-group"><div class="key media" data-code="MediaTrackPrevious">‚èÆ</div><div class="key media" data-code="MediaPlayPause">‚èØ</div><div class="key media" data-code="MediaStop">‚èπ</div><div class="key media" data-code="MediaTrackNext">‚è≠</div></div>
            <div class="media-group"><div class="key media" data-code="VolumeMute">üîá</div><div class="key media" data-code="VolumeDown">üîâ</div><div class="key media" data-code="VolumeUp">üîä</div></div>
        </div>
        <div class="function-row">
            <div class="f-group"><div class="key" data-code="Escape">Esc</div></div>
            <div class="f-group"><div class="key" data-code="F1">F1</div><div class="key" data-code="F2">F2</div><div class="key" data-code="F3">F3</div><div class="key" data-code="F4">F4</div></div>
            <div class="f-group"><div class="key" data-code="F5">F5</div><div class="key" data-code="F6">F6</div><div class="key" data-code="F7">F7</div><div class="key" data-code="F8">F8</div></div>
            <div class="f-group"><div class="key" data-code="F9">F9</div><div class="key" data-code="F10">F10</div><div class="key" data-code="F11">F11</div><div class="key" data-code="F12">F12</div></div>
            <div class="f-group" style="margin-left: 15px;"><div class="key" data-code="PrintScreen">PrtSc</div><div class="key" data-code="ScrollLock">ScrLk</div><div class="key" data-code="Pause">Pause</div></div>
        </div>
        <div class="keyboard-body">
            <div class="main-block">
                <div class="row"><div class="key" data-code="Backquote">~</div><div class="key" data-code="Digit1">1</div><div class="key" data-code="Digit2">2</div><div class="key" data-code="Digit3">3</div><div class="key" data-code="Digit4">4</div><div class="key" data-code="Digit5">5</div><div class="key" data-code="Digit6">6</div><div class="key" data-code="Digit7">7</div><div class="key" data-code="Digit8">8</div><div class="key" data-code="Digit9">9</div><div class="key" data-code="Digit0">0</div><div class="key" data-code="Minus">-</div><div class="key" data-code="Equal">=</div><div class="key w-full" data-code="Backspace">Backspace</div></div>
                <div class="row"><div class="key w-2" data-code="Tab">Tab</div><div class="key" data-code="KeyQ">Q</div><div class="key" data-code="KeyW">W</div><div class="key" data-code="KeyE">E</div><div class="key" data-code="KeyR">R</div><div class="key" data-code="KeyT">T</div><div class="key" data-code="KeyY">Y</div><div class="key" data-code="KeyU">U</div><div class="key" data-code="KeyI">I</div><div class="key" data-code="KeyO">O</div><div class="key" data-code="KeyP">P</div><div class="key" data-code="BracketLeft">[</div><div class="key" data-code="BracketRight">]</div><div class="key w-full" data-code="Backslash">\</div></div>
                <div class="row"><div class="key w-3" data-code="CapsLock">Caps</div><div class="key" data-code="KeyA">A</div><div class="key" data-code="KeyS">S</div><div class="key" data-code="KeyD">D</div><div class="key" data-code="KeyF">F</div><div class="key" data-code="KeyG">G</div><div class="key" data-code="KeyH">H</div><div class="key" data-code="KeyJ">J</div><div class="key" data-code="KeyK">K</div><div class="key" data-code="KeyL">L</div><div class="key" data-code="Semicolon">;</div><div class="key" data-code="Quote">'</div><div class="key w-full" data-code="Enter">Enter</div></div>
                <div class="row"><div class="key w-4" data-code="ShiftLeft">Shift</div><div class="key" data-code="KeyZ">Z</div><div class="key" data-code="KeyX">X</div><div class="key" data-code="KeyC">C</div><div class="key" data-code="KeyV">V</div><div class="key" data-code="KeyB">B</div><div class="key" data-code="KeyN">N</div><div class="key" data-code="KeyM">M</div><div class="key" data-code="Comma">,</div><div class="key" data-code="Period">.</div><div class="key" data-code="Slash">/</div><div class="key w-full" data-code="ShiftRight">Shift</div></div>
                <div class="row"><div class="key w-5" data-code="ControlLeft">Ctrl</div><div class="key w-5" data-code="MetaLeft">Win</div><div class="key w-5" data-code="AltLeft">Alt</div><div class="key w-space" data-code="Space">Space</div><div class="key w-5" data-code="AltRight">Alt</div><div class="key w-5" data-code="MetaRight">Win</div><div class="key w-5" data-code="ContextMenu">Menu</div><div class="key w-5" data-code="ControlRight">Ctrl</div></div>
            </div>
            <div class="nav-block">
                <div class="nav-grid"><div class="key" data-code="Insert">Ins</div><div class="key" data-code="Home">Home</div><div class="key" data-code="PageUp">PgUp</div><div class="key" data-code="Delete">Del</div><div class="key" data-code="End">End</div><div class="key" data-code="PageDown">PgDn</div></div>
                <div class="nav-grid"><div class="key" style="visibility: hidden;"></div><div class="key" data-code="ArrowUp">‚Üë</div><div class="key" style="visibility: hidden;"></div><div class="key" data-code="ArrowLeft">‚Üê</div><div class="key" data-code="ArrowDown">‚Üì</div><div class="key" data-code="ArrowRight">‚Üí</div></div>
            </div>
            <div class="numpad-block">
                <div class="key" data-code="NumLock">Num</div><div class="key" data-code="NumpadDivide">/</div><div class="key" data-code="NumpadMultiply">*</div><div class="key" data-code="NumpadSubtract">-</div>
                <div class="key" data-code="Numpad7">7</div><div class="key" data-code="Numpad8">8</div><div class="key" data-code="Numpad9">9</div><div class="key h-2" data-code="NumpadAdd">+</div>
                <div class="key" data-code="Numpad4">4</div><div class="key" data-code="Numpad5">5</div><div class="key" data-code="Numpad6">6</div>
                <div class="key" data-code="Numpad1">1</div><div class="key" data-code="Numpad2">2</div><div class="key" data-code="Numpad3">3</div><div class="key h-2" data-code="NumpadEnter">Ent</div>
                <div class="key w-num-0" data-code="Numpad0">0</div><div class="key" data-code="NumpadDecimal">.</div>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="panel">
            <div class="panel-header"><span>Riwayat Input</span><button onclick="clearLog()">Hapus</button></div>
            <div id="key-history"></div>
        </div>
        <div class="panel">
            <div class="panel-header">Statistik Kecepatan</div>
            <div class="stats-grid">
                <div class="stat-box"><div id="tpm-display" class="stat-val">0</div><div class="stat-lbl">Tombol / Menit</div></div>
                <div class="stat-box"><div id="tested-count" class="stat-val">0</div><div class="stat-lbl">Tombol Unik</div></div>
            </div>
        </div>
        <div class="panel">
            <div class="panel-header"><span>Ghosting Test</span><button class="btn-reset" onclick="resetAll()">Reset Test</button></div>
            <div class="ghosting-display">
                <div id="current-pressed" class="ghost-val">0</div>
                <div class="ghost-lbl">Ditekan Bersamaan</div>
                <div id="max-pressed" class="ghost-max">Max: 0</div>
            </div>
        </div>
    </div>

    <script>
        // --- AUDIO ENGINE (BASE64) ---
        // Ini adalah data suara "Mechanical Switch" yang di-encode agar tidak butuh file eksternal
        const clickSoundBase64 = "data:audio/wav;base64,UklGRi4AAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="; // Placeholder aman
        // Untuk suara "Click" yang lebih realistis dan pendek, kita gunakan Web Audio API Oscillator
        // karena Base64 suara asli terlalu panjang untuk chat ini.
        // Kita buat fungsi "Synth" sederhana untuk suara 'Thock'.
        
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playThockSound() {
            // Cek apakah switch ON
            const isSoundOn = document.getElementById('sound-toggle').checked;
            if (!isSoundOn) return;

            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            // Karakteristik suara "Thock" (Campuran Square wave & Low pass filter)
            osc.type = 'square';
            osc.frequency.setValueAtTime(150, t);
            osc.frequency.exponentialRampToValueAtTime(40, t + 0.05);

            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(800, t);
            filter.frequency.exponentialRampToValueAtTime(100, t + 0.08);

            gain.gain.setValueAtTime(0.3, t);
            gain.gain.exponentialRampToValueAtTime(0.01, t + 0.08);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start(t);
            osc.stop(t + 0.1);
        }

        // --- CORE VARIABLES ---
        const historyContainer = document.getElementById('key-history');
        const tpmDisplay = document.getElementById('tpm-display');
        const testedCountDisplay = document.getElementById('tested-count');
        const currentPressedDisplay = document.getElementById('current-pressed');
        const maxPressedDisplay = document.getElementById('max-pressed');
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');

        let testedKeys = new Set();
        let activeKeys = new Set();
        let maxSimultaneous = 0;
        let startTime = null;
        let keystrokeCount = 0;
        let timerInterval = null;
        const totalKeysInUI = document.querySelectorAll('.key').length;

        // --- HELPER FUNCTIONS ---
        function formatLabel(code) {
            if (code.startsWith('Key')) return code.replace('Key', '');
            if (code.startsWith('Digit')) return code.replace('Digit', '');
            if (code.startsWith('Numpad')) return code.replace('Numpad', 'Num ');
            if (code === 'ArrowUp') return '‚Üë';
            if (code === 'ArrowDown') return '‚Üì';
            if (code === 'ArrowLeft') return '‚Üê';
            if (code === 'ArrowRight') return '‚Üí';
            if (code === 'Space') return 'Space';
            return code;
        }

        function updateVisuals(code, isKeyDown) {
            const keyElement = document.querySelector(`.key[data-code="${code}"]`);
            if (keyElement) {
                if (isKeyDown) {
                    keyElement.classList.add('active');
                    keyElement.classList.add('tested');
                } else {
                    keyElement.classList.remove('active');
                }
            }
        }

        function updateProgress() {
            const count = testedKeys.size;
            const percentage = Math.floor((count / totalKeysInUI) * 100);
            progressBar.style.width = percentage + '%';
            progressPercent.innerText = percentage + '% (' + count + '/' + totalKeysInUI + ')';
            testedCountDisplay.innerText = count;
        }

        function updateGhostingStats() {
            const current = activeKeys.size;
            currentPressedDisplay.innerText = current;
            if (current > 5) currentPressedDisplay.style.color = '#ff0055';
            else currentPressedDisplay.style.color = '#fff';

            if (current > maxSimultaneous) {
                maxSimultaneous = current;
                maxPressedDisplay.innerText = `Max: ${maxSimultaneous}`;
            }
        }

        function updateTPM() {
            if (!startTime) return;
            const min = (Date.now() - startTime) / 60000;
            const tpm = min > 0 ? Math.round(keystrokeCount / min) : 0;
            tpmDisplay.innerText = tpm;
        }

        // --- EVENT LISTENERS ---
        window.addEventListener('keydown', (e) => {
            if(e.code === 'Tab' || e.code === 'AltLeft' || e.code === 'AltRight' || e.code.startsWith('F')) {
               e.preventDefault();
            }
            if (e.repeat) return; 

            // PLAY SOUND
            playThockSound();

            activeKeys.add(e.code);
            testedKeys.add(e.code);
            keystrokeCount++;
            if (!startTime) {
                startTime = Date.now();
                timerInterval = setInterval(updateTPM, 1000);
            }

            updateVisuals(e.code, true);
            updateProgress();
            updateGhostingStats();
            updateTPM();

            const item = document.createElement('div');
            item.classList.add('log-item');
            item.innerText = formatLabel(e.code);
            historyContainer.appendChild(item);
            historyContainer.scrollTop = historyContainer.scrollHeight;
        });

        window.addEventListener('keyup', (e) => {
            activeKeys.delete(e.code);
            updateVisuals(e.code, false);
            updateGhostingStats();
        });

        function clearLog() {
            historyContainer.innerHTML = '';
        }

        function resetAll() {
            testedKeys.clear();
            activeKeys.clear();
            maxSimultaneous = 0;
            keystrokeCount = 0;
            startTime = null;
            clearInterval(timerInterval);
            tpmDisplay.innerText = '0';
            testedCountDisplay.innerText = '0';
            currentPressedDisplay.innerText = '0';
            maxPressedDisplay.innerText = 'Max: 0';
            document.querySelectorAll('.key').forEach(k => {
                k.classList.remove('active');
                k.classList.remove('tested');
            });
            clearLog();
            updateProgress();
        }
    </script>
</body>
</html>
